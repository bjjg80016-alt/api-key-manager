# é£ä¹¦å¯†é’¥è®¾ç½®æŒ‡å—

## ğŸ“‹ é£ä¹¦APIå¯†é’¥ç±»å‹

é£ä¹¦æä¾›äº†å¤šç§APIå¯†é’¥å’Œé…ç½®ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

### 1. é£ä¹¦æœºå™¨äººWebhook
- **ç”¨é€”**: æ¶ˆæ¯æ¨é€é€šçŸ¥
- **è·å–æ–¹å¼**: é£ä¹¦ç¾¤ç»„ -> è®¾ç½® -> ç¾¤æœºå™¨äºº -> æ·»åŠ æœºå™¨äºº -> è‡ªå®šä¹‰æœºå™¨äºº
- **æ ¼å¼**: `https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx`

### 2. é£ä¹¦åº”ç”¨å‡­è¯
- **ç”¨é€”**: è°ƒç”¨é£ä¹¦å¼€æ”¾å¹³å°API
- **åŒ…å«å†…å®¹**:
  - App ID (åº”ç”¨å‡­è¯)
  - App Secret (åº”ç”¨å¯†é’¥)
  - Tenant Key (ç§Ÿæˆ·å¯†é’¥)

### 3. é£ä¹¦ç”¨æˆ·è®¿é—®ä»¤ç‰Œ
- **ç”¨é€”**: ç”¨æˆ·èº«ä»½éªŒè¯
- **ç±»å‹**: App Access Token, User Access Token

## ğŸš€ è®¾ç½®æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šé€šè¿‡Webç•Œé¢è®¾ç½®

1. **æ‰“å¼€Webç•Œé¢**
   ```bash
   # å¯åŠ¨WebæœåŠ¡
   python src/web_interface.py
   # æˆ–æ‰“å¼€é™æ€HTMLæ–‡ä»¶
   # åŒå‡» web_interface.html
   ```

2. **æ·»åŠ é£ä¹¦å¯†é’¥**
   - é€‰æ‹©æœåŠ¡ç±»å‹ï¼š`feishu` æˆ– `è‡ªå®šä¹‰`
   - æœåŠ¡åç§°ï¼š`feishu`
   - APIå¯†é’¥ï¼šè¾“å…¥æ‚¨çš„é£ä¹¦Webhook URLæˆ–åº”ç”¨å‡­è¯

### æ–¹æ³•äºŒï¼šé€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®

ç¼–è¾‘ `config/api_config.json`ï¼š

```json
{
  "api_keys": {
    "feishu": "https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx",
    "feishu_app_id": "cli_xxxxxxxxxxxx",
    "feishu_app_secret": "xxxxxxxxxxxxxxxx"
  },
  "endpoints": {
    "feishu": "https://open.feishu.cn/open-apis"
  },
  "rates": {
    "feishu": {
      "rpm": 60,
      "tpm": 90000
    }
  }
}
```

### æ–¹æ³•ä¸‰ï¼šé€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®

```bash
# Windows
set FEISHU_WEBHOOK=https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx
set FEISHU_APP_ID=cli_xxxxxxxxxxxx
set FEISHU_APP_SECRET=xxxxxxxxxxxxxxxx

# Linux/Mac
export FEISHU_WEBHOOK=https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx
export FEISHU_APP_ID=cli_xxxxxxxxxxxx
export FEISHU_APP_SECRET=xxxxxxxxxxxxxxxx
```

### æ–¹æ³•å››ï¼šé€šè¿‡å‘½ä»¤è¡Œå·¥å…·è®¾ç½®

```bash
# å¯åŠ¨å‘½ä»¤è¡Œå·¥å…·
python src/api_key_manager.py

# é€‰æ‹©é€‰é¡¹2ï¼šè®¾ç½®/æ›´æ–°APIå¯†é’¥
# è¾“å…¥æœåŠ¡åç§°ï¼šfeishu
# è¾“å…¥APIå¯†é’¥ï¼šæ‚¨çš„é£ä¹¦Webhook URL
```

## ğŸ”§ è·å–é£ä¹¦å¯†é’¥

### è·å–é£ä¹¦æœºå™¨äººWebhook

1. **åˆ›å»ºç¾¤ç»„æœºå™¨äºº**
   - æ‰“å¼€é£ä¹¦å®¢æˆ·ç«¯
   - è¿›å…¥ç›®æ ‡ç¾¤ç»„
   - ç‚¹å‡»ç¾¤ç»„è®¾ç½®
   - é€‰æ‹©"ç¾¤æœºå™¨äºº"
   - ç‚¹å‡»"æ·»åŠ æœºå™¨äºº"
   - é€‰æ‹©"è‡ªå®šä¹‰æœºå™¨äºº"
   - å¡«å†™æœºå™¨äººåç§°å’Œæè¿°
   - å¤åˆ¶Webhook URL

2. **Webhook URLæ ¼å¼**
   ```
   https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxxxxxxxxxx
   ```

### è·å–é£ä¹¦åº”ç”¨å‡­è¯

1. **åˆ›å»ºé£ä¹¦åº”ç”¨**
   - è®¿é—® [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
   - ç™»å½•å¹¶è¿›å…¥å¼€å‘è€…æ§åˆ¶å°
   - åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
   - è·å– App ID å’Œ App Secret

2. **åº”ç”¨æƒé™é…ç½®**
   - åœ¨åº”ç”¨ç®¡ç†ä¸­è®¾ç½®æ‰€éœ€æƒé™
   - å¦‚ï¼šæ¶ˆæ¯æ¨é€ã€ç”¨æˆ·ä¿¡æ¯è¯»å–ç­‰

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### å‘é€æ¶ˆæ¯åˆ°é£ä¹¦

```python
import requests
import json

# ä»APIå¯†é’¥ç®¡ç†å™¨è·å–é£ä¹¦Webhook
webhook_url = manager.get_api_key('feishu')

# å‘é€æ¶ˆæ¯
message = {
    "msg_type": "text",
    "content": {
        "text": "Hello from API Key Manager!"
    }
}

response = requests.post(webhook_url, json=message)
print(response.json())
```

### ä½¿ç”¨é£ä¹¦API

```python
import requests
import json

# è·å–åº”ç”¨å‡­è¯
app_id = manager.get_api_key('feishu_app_id')
app_secret = manager.get_api_key('feishu_app_secret')

# è·å–è®¿é—®ä»¤ç‰Œ
token_url = "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal"
token_data = {
    "app_id": app_id,
    "app_secret": app_secret
}

token_response = requests.post(token_url, json=token_data)
access_token = token_response.json().get('tenant_access_token')

# ä½¿ç”¨è®¿é—®ä»¤ç‰Œè°ƒç”¨API
headers = {
    "Authorization": f"Bearer {access_token}",
    "Content-Type": "application/json"
}

# å‘é€æ¶ˆæ¯
message_url = "https://open.feishu.cn/open-apis/im/v1/messages"
message_data = {
    "receive_id": "ou_xxxxxxxxxxxx",
    "content": json.dumps({
        "text": "Hello from API Key Manager!"
    }),
    "msg_type": "text"
}

message_response = requests.post(message_url, headers=headers, json=message_data)
print(message_response.json())
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. **å¯†é’¥ä¿æŠ¤**
   - ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
   - ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
   - å®šæœŸæ›´æ¢å¯†é’¥

2. **æƒé™æ§åˆ¶**
   - ä¸ºåº”ç”¨è®¾ç½®æœ€å°å¿…è¦æƒé™
   - å®šæœŸå®¡æŸ¥åº”ç”¨æƒé™
   - ç›‘æ§APIè°ƒç”¨æ—¥å¿—

3. **ä½¿ç”¨é™åˆ¶**
   - éµå®ˆé£ä¹¦APIè°ƒç”¨é¢‘ç‡é™åˆ¶
   - å®ç°é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
   - ç›‘æ§APIä½¿ç”¨æƒ…å†µ

## ğŸ§ª æµ‹è¯•é£ä¹¦å¯†é’¥

### æµ‹è¯•Webhook

```python
import requests

def test_feishu_webhook(webhook_url):
    """æµ‹è¯•é£ä¹¦Webhook"""
    test_message = {
        "msg_type": "text",
        "content": {
            "text": "ğŸ§ª é£ä¹¦Webhookæµ‹è¯•æ¶ˆæ¯"
        }
    }
    
    try:
        response = requests.post(webhook_url, json=test_message)
        if response.status_code == 200:
            print("âœ… é£ä¹¦Webhookæµ‹è¯•æˆåŠŸ")
            return True
        else:
            print(f"âŒ é£ä¹¦Webhookæµ‹è¯•å¤±è´¥: {response.status_code}")
            return False
    except Exception as e:
        print(f"âŒ é£ä¹¦Webhookæµ‹è¯•å¼‚å¸¸: {e}")
        return False
```

### æµ‹è¯•åº”ç”¨å‡­è¯

```python
import requests

def test_feishu_app(app_id, app_secret):
    """æµ‹è¯•é£ä¹¦åº”ç”¨å‡­è¯"""
    token_url = "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal"
    token_data = {
        "app_id": app_id,
        "app_secret": app_secret
    }
    
    try:
        response = requests.post(token_url, json=token_data)
        if response.status_code == 200:
            result = response.json()
            if result.get('code') == 0:
                print("âœ… é£ä¹¦åº”ç”¨å‡­è¯æµ‹è¯•æˆåŠŸ")
                print(f"è®¿é—®ä»¤ç‰Œ: {result.get('tenant_access_token')}")
                return True
            else:
                print(f"âŒ é£ä¹¦åº”ç”¨å‡­è¯æµ‹è¯•å¤±è´¥: {result.get('msg')}")
                return False
        else:
            print(f"âŒ é£ä¹¦åº”ç”¨å‡­è¯æµ‹è¯•å¤±è´¥: {response.status_code}")
            return False
    except Exception as e:
        print(f"âŒ é£ä¹¦åº”ç”¨å‡­è¯æµ‹è¯•å¼‚å¸¸: {e}")
        return False
```

## ğŸ“š ç›¸å…³èµ„æº

- [é£ä¹¦å¼€æ”¾å¹³å°æ–‡æ¡£](https://open.feishu.cn/document/)
- [é£ä¹¦æœºå™¨äººå¼€å‘æŒ‡å—](https://open.feishu.cn/document/ukTMukTMukTM/ucDO1UjL4gDO14CO4gTN)
- [é£ä¹¦APIå‚è€ƒ](https://open.feishu.cn/document/ukTMukTMukTM/uYjNwUjL2YDM14iN2ATN)

---

ç°åœ¨æ‚¨å¯ä»¥æ ¹æ®ä»¥ä¸ŠæŒ‡å—åœ¨APIå¯†é’¥ç®¡ç†å·¥å…·ä¸­è®¾ç½®æ‚¨çš„é£ä¹¦å¯†é’¥äº†ï¼